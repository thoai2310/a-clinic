FROM node:22-alpine

WORKDIR /app

# Install global tools
RUN npm install -g @vue/cli @vitejs/plugin-vue

# Create entrypoint script
RUN cat > /entrypoint.sh << 'EOF'
#!/bin/sh

echo "ğŸ” Checking working directory: $(pwd)"
echo "ğŸ“‚ Listing files: $(ls -la)"

# Check if package.json exists
if [ -f "package.json" ]; then
    echo "ğŸ“¦ Found package.json"

    # Check if node_modules exists and has content
    if [ ! -d "node_modules" ] || [ -z "$(ls -A node_modules 2>/dev/null)" ]; then
        echo "ğŸš€ Installing dependencies... (this may take a few minutes)"
        npm install
        echo "âœ… Dependencies installed successfully!"
    else
        echo "âœ… Dependencies already installed"
    fi

    echo "ğŸš€ Starting development server..."
    exec npm run dev -- --host 0.0.0.0 --port 5173
else
    echo "âŒ No package.json found in $(pwd)"
    echo "â³ Waiting..."
    tail -f /dev/null
fi
EOF

RUN chmod +x /entrypoint.sh

EXPOSE 5173

ENTRYPOINT ["/entrypoint.sh"]